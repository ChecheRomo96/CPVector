# This starter workflow is for a CMake project running on multiple platforms. There is a different starter workflow if you just want a single platform.
# See: https://github.com/actions/starter-workflows/blob/main/ci/cmake-single-platform.yml
name: Doxygen to Github Pages

on:
  workflow_dispatch:

jobs:
  ArduinoDocsC:
    runs-on: macos-latest

    strategy:
      # Set fail-fast to false to ensure that feedback is delivered for all matrix combinations. Consider changing this to true when your workflow is stable.
      fail-fast: false

    steps:
      - name: Checkout
        uses: actions/checkout@v3.5.3

      - name: Set reusable strings
        # Turn repeated input strings (such as the build output directory) into step outputs. These step outputs can be used throughout the workflow file.
        id: strings
        shell: bash
        run: |
          echo "build-output-dir=${{ github.workspace }}/build" >> "$GITHUB_OUTPUT"
          
           
      - name: Create New Directory to copy the contets
        run: |
          tree -a |
          mkdir -p ./ArduinoBuild |
          mkdir -p ./docs/Arduino_C
        
      - name: Copy the source code and other files
        run: |
          cp -R ./src ./ArduinoBuild |
          cp -R ./examples ./ArduinoBuild |
          cp ./.gitignore ./ArduinoBuild |
          cp ./LICENSE ./ArduinoBuild |
          cp ./README.md ./ArduinoBuild |
          cp ./resources/keywords.txt ./ArduinoBuild |
          cp ./resources/library.properties ./ArduinoBuild |
          cp ./resources/doxy/ArduinoDocs_C.doxy ./ArduinoBuild |
          cp ./resources/doxy/DoxygenLayout.xml ./ArduinoBuild
          
      - name: Remove examples from Arduino subfolder
        run: |
          for i in ` find ./ArduinoBuild -name Arduino ` ; do mv $i/* $i/.. ; done
          
          
      - name: Remove files not needed from the new directory
        run: |
          find ./docs/Arduino_C -name "CMakeLists.txt" -type f -delete |
          find ./docs/Arduino_C -name "Desktop" -type d -exec rm -rf {} + |
          find ./docs/Arduino_C -name "PSoC" -type d -exec rm -rf {} +

      - name: Initialize and Update Submodules
        run: |
          git submodule init
          git submodule update
          
      - name: Install Doxygen
        run: brew install doxygen
        
      - name: Install Graphviz
        run: brew install graphviz

      - name: Generate Documentation
        run: doxygen ArduinoDocs_C.doxy

      - name: Creaye .nojekyll file
        run: |
          cd docs/html |
          touch .nojekyll |
          cd ../..

      - name: Show file structure
        run: tree ./docs/Arduino_C -a
      
    #- name: Deploy to GitHub Pages
    #  if: success()
    #  uses: peaceiris/actions-gh-pages@v3
    #  with:
    #    personal_token: ${{ secrets.PERSONAL_TOKEN }}
    #    external_repository: ChecheRomo96/CPVector_Arduino
    #    publish_branch: master
    #    publish_dir: ./docs/Arduino_C
    #    force_orphan: false
    #    disable_nojekyll: true
    #    allow_empty_commit: true
