name: Create Releases
on:
  workflow_dispatch:
jobs:
  ArduinoRelease:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3.5.3
         
      - name: Create New Directory to copy the contets
        run: |
          mkdir ArduinoRelease
          
      - name: Copy the source code and other files
        run: ls -a 
        
      - name: Copy the source code and other files
        run: |
          cp -R ./src ./ArduinoRelease |
          cp -R ./examples ./ArduinoRelease |
          cp ./.gitignore ./ArduinoRelease |
          cp ./LICENSE ./ArduinoRelease |
          cp ./README.md ./ArduinoRelease |
          cp ./resources/arduino/keywords.txt ./ArduinoRelease |
          cp ./resources/arduino/library.properties ./ArduinoRelease
          
      - name: Remove examples from Arduino subfolder
        run: |
          for i in ` find . -name Arduino ` ; do mv $i/* $i/.. ; done
          
          
      - name: Remove CMakeLists.txt files
        run: |
          find ./ArduinoRelease -name "CMakeLists.txt" -type f -delete |
          find ./ArduinoRelease -name "*.dox" -type f -delete |
          find ./ArduinoRelease -name "Desktop" -type d -exec rm -rf {} + |
          find ./ArduinoRelease -name "PSoC" -type d -exec rm -rf {} +
          
      - name: Deploy Arduino Bramch
        if: success()
        uses: peaceiris/actions-gh-pages@v3
        with:
          personal_token: ${{ secrets.PERSONAL_TOKEN }}
          external_repository: ChecheRomo96/CPVector_Arduino
          publish_branch: master
          publish_dir: ./ArduinoRelease
          force_orphan: false
          disable_nojekyll: true
          allow_empty_commit: true
        
      - name: Show file structure
        run: |
          tree ./ArduinoRelease -a
          
  CMakeRelease:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3.5.3

      - name: Create New Directory to copy the contets
        run: |
          mkdir CMakeRelease
          
      - name: Copy the source code and other files
        run: |
          cp -R ./src ./CMakeRelease |
          cp -R ./examples ./CMakeRelease |
          cp -R ./tests ./CMakeRelease |
          cp ./.gitignore ./CMakeRelease |
          cp ./LICENSE ./CMakeRelease |
          cp ./README.md ./CMakeRelease |
          cp ./CMakeLists.txt ./CMakeRelease
          
      - name: Remove examples from Desktop subfolder
        run: |
          for i in ` find . -name Desktop ` ; do mv $i/* $i/.. ; done
          
      - name: Remove CMakeLists.txt files
        run: |
          find ./CMakeRelease -name "*.dox" -type f -delete |
          find ./CMakeRelease -name "*.ino" -type f -delete |
          find ./CMakeRelease -name "Desktop" -type d -exec rm -rf {} + |
          find ./CMakeRelease -name "PSoC" -type d -exec rm -rf {} +
              
      #- name: Push directory to another repository
      #  uses: cpina/github-action-push-to-another-repository@v1.7.2
      #  env:
      #    SSH_DEPLOY_KEY: ${{ secrets.SSH_DEPLOY_KEY }}
      #    API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
      #  with:
      #    source-directory: './CMakeRelease'
      #    destination-github-username: 'ChecheRomo96'
      #    destination-repository-name: 'CPVector-CMake'
      #    user-email: josemanuel.romo.96@gmail.com
      #    user-email: josemanuel.romo.96@gmail.com
      #    target-branch: main

      - name: Deploy CMake Bramch
        if: success()
        uses: peaceiris/actions-gh-pages@v3
        with:
          personal_token: ${{ secrets.PERSONAL_TOKEN }}
          external_repository: ChecheRomo96/CPVector_CMake
          publish_branch: Update
          publish_dir: ./CMakeRelease
          force_orphan: false
          disable_nojekyll: true
          allow_empty_commit: true

      - name: Show file structure
        run: |
          tree ./CMakeRelease


          
